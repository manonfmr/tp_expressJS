<!DOCTYPE html>
<html>
<head>
    <title>Annonce</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-cookies.js"></script>
</head>
<body ng-app="myApp" ng-controller="myCtrl">
    <div class="container">
        <h3 class="titre_session">{{login}}</h3>
        <h1 class="titre">Liste des annonces</h1>

        <button type="button" onclick="loadAnnonce()">Voir les annonces</button>

        <div id="annonce" class="annonces">
            <div ng-repeat="monAnnonce in mesAnnonces" class="annonce">
                <my-annonce label="A propos" on-click="onClickfunction(selectedValueNom)" mon-annonce="monAnnonce"></my-annonce>
            </div>
        </div>

        <form class="form" action="/logout" method="GET">
            <button class="submit" type="submit">Déconnexion</button>
        </form>
    </div>
    
    <script>
        
        function loadAnnonce() {
            const xhttp = new XMLHttpRequest();
            const loginValue = document.getElementById('annonce').value;

            xhttp.onload = function() {
                const response = JSON.parse(this.responseText);
                if (response.success) {
                    console.log('ok');
                } else {
                    console.log('ko');
                }
            };

            xhttp.open("POST", "./ajaxAnnonce.html", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");  
            xhttp.send();
        }

        var app = angular.module("myApp", ["ngCookies"]);
        
        app.controller("myCtrl", function($scope, $cookies){
            
            const login = localStorage.getItem('login');
            // Utiliser la valeur du login comme nécessaire
            console.log('Login:', login);
            $scope.login = login;

            $scope.mesAnnonces=['musique', 'sport', 'concert', 'lecture'];
            $scope.onClickfunction = function(selectedValueNom){
                $cookies.put("selected_annonce", selectedValueNom);
            };
        });


        app.directive('myAnnonce', function(){
            return {
                restrict: 'E',
                template: `
                    <div class="annonce-info">
                        <h2 class="annonce-title">{{ monAnnonce }}</h2>
                        <img ng-src="{{ monAnnonce + '.png' }}" class="annonce-image" alt="Image de l'annonce {{monAnnonce}}">
                    </div>
                    <a class="link" ng-click="onClick({ selectedValueNom: monAnnonce })" href="Apropos.html">{{ label }}</a>
                `,
                scope: {
                    label: '@',
                    onClick: '&',
                    monAnnonce: '=' 
                }
            };
        });
    </script>
</body>
</html>
